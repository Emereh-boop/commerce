-- Create "users" table
CREATE TABLE "users" ("user_id" uuid NOT NULL DEFAULT gen_random_uuid(), "auth0_sub" character varying(255) NULL, "email" character varying(255) NOT NULL, "name" character varying(255) NULL, "profile_picture_url" text NULL, "created_at" timestamp NULL DEFAULT now(), "last_login" timestamp NULL, PRIMARY KEY ("user_id"), CONSTRAINT "users_auth0_sub_key" UNIQUE ("auth0_sub"));
-- Create "shops" table
CREATE TABLE "shops" ("shop_id" bigserial NOT NULL, "owner_id" uuid NOT NULL, "title" character varying(50) NOT NULL, "default_domain" character varying(50) NOT NULL, "favicon_url" text NULL, "logo_url" text NULL, "email" character varying(50) NOT NULL, "currency_code" character varying(3) NOT NULL, "status" character varying(10) NOT NULL, "about" text NULL, "address" text NULL, "phone_number" character varying(15) NULL, "seo_description" text NULL, "seo_keywords" text[] NULL, "seo_title" character varying(255) NULL, "updated_at" timestamptz NOT NULL DEFAULT now(), "created_at" timestamptz NOT NULL DEFAULT now(), PRIMARY KEY ("shop_id"), CONSTRAINT "shops_default_domain_key" UNIQUE ("default_domain"), CONSTRAINT "fk_owner" FOREIGN KEY ("owner_id") REFERENCES "users" ("user_id") ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT "shops_default_domain_check" CHECK ((default_domain)::text ~~ '%.%'::text));
-- Create "categories" table
CREATE TABLE "categories" ("category_id" bigserial NOT NULL, "slug" character varying(50) NOT NULL, "title" character varying(50) NOT NULL, "description" character varying(255) NULL, "parent_id" bigint NULL, "allowed_attributes" jsonb NULL, "created_at" timestamptz NOT NULL DEFAULT now(), "updated_at" timestamptz NOT NULL DEFAULT now(), "shop_id" bigint NOT NULL, PRIMARY KEY ("category_id"), CONSTRAINT "categories_slug_shop_id_key" UNIQUE ("slug", "shop_id"), CONSTRAINT "fk_parent" FOREIGN KEY ("parent_id") REFERENCES "categories" ("category_id") ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT "fk_shop" FOREIGN KEY ("shop_id") REFERENCES "shops" ("shop_id") ON UPDATE NO ACTION ON DELETE NO ACTION);
-- Create "whatsapps" table
CREATE TABLE "whatsapps" ("whatsapp_id" bigserial NOT NULL, "phone_number" character varying(15) NOT NULL, "country_code" character varying(5) NOT NULL, "url" text NOT NULL, "created_at" timestamptz NOT NULL DEFAULT now(), "shop_id" bigint NOT NULL, PRIMARY KEY ("whatsapp_id"), CONSTRAINT "fk_shop" FOREIGN KEY ("shop_id") REFERENCES "shops" ("shop_id") ON UPDATE NO ACTION ON DELETE NO ACTION);
